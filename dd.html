<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–æ–ª—è–Ω</title>
  <style>
    /* ============ –°–ë–†–û–° –ò –¶–ï–ù–¢–†–û–í–ö–ê ============ */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f5f5f5;
      font-family: Arial, sans-serif;
    }

    .container {
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
      font-size: 28px;
    }

    /* ============ –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ö–û–õ–ï–°–ê ============ */
    #wheel-container {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 0 auto 20px;
    }

    /* ============ –°–ê–ú–û –ö–û–õ–ï–°–û (CANVAS) ============ */
    #wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      cursor: pointer;
      /* –í—Ä–µ–º—è –≤—Ä–∞—â–µ–Ω–∏—è —É–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 8 —Å–µ–∫—É–Ω–¥ */
      transition: transform 8s cubic-bezier(0.33, 1, 0.68, 1);
      background-color: #ffffff; /* –Ω–∞ –±–µ–ª–æ–º —Ñ–æ–Ω–µ –≤–∏–¥–Ω–æ —Å–µ–≥–º–µ–Ω—Ç—ã */
    }

    /* ============ –°–¢–†–ï–õ–ö–ê –°–ü–†–ê–í–ê ============ */
    #pointer {
      position: absolute;
      top: 50%;
      right: -20px;
      transform: translateY(-50%);
      width: 0;
      height: 0;
      /* –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –≤–ª–µ–≤–æ */
      border-top: 20px solid transparent;
      border-bottom: 20px solid transparent;
      border-right: 40px solid #e74c3c;
      z-index: 2;
    }

    /* ============ –ö–ù–û–ü–ö–ê ¬´–ö–†–£–¢–ò–¢–¨¬ª ============ */
    #spin-btn {
      padding: 10px 20px;
      font-size: 16px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #spin-btn:disabled {
      background: #95a5a6;
      cursor: not-allowed;
    }
    #spin-btn:hover:not(:disabled) {
      background: #2980b9;
    }

    /* ============ –¢–ï–ö–°–¢ –†–ï–ó–£–õ–¨–¢–ê–¢–ê ============ */
    #result {
      margin-top: 20px;
      font-size: 18px;
      min-height: 24px;
      color: #2c3e50;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>–ö—Ç–æ –ö–æ–ª—è–Ω —Å–µ–≥–æ–¥–Ω—è?</h1>
    <div id="wheel-container">
      <div id="pointer"></div>
      <!-- –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: width –∏ height —É canvas –∑–∞–¥–∞–Ω—ã –∏–º–µ–Ω–Ω–æ –≤ HTML -->
      <canvas id="wheel" width="400" height="400"></canvas>
    </div>
    <button id="spin-btn">–ö—Ä—É—Ç–∏—Ç—å</button>
    <div id="result"></div>
  </div>

  <!-- ============ JS-–ö–û–î ============ -->
  <script>
    // 1) –û–ü–ò–°–´–í–ê–ï–ú –°–ï–ì–ú–ï–ù–¢–´: 
    //    label ‚Äî —Ç–µ–∫—Å—Ç, color ‚Äî —Ñ–æ–Ω —Å–µ–≥–º–µ–Ω—Ç–∞
    const segments = [
      { label: "–ü–µ–¥–∏–∫", color: "#e74c3c" },
      { label: "–ì–µ–π", color: "#8e44ad" },
      { label: "–•—É–µ—Å–æ—Å", color: "#3498db" },
      { label: "–ü–∏–¥–æ—Ä–∞—Å", color: "#1abc9c" },
      { label: "–ü–µ–¥—Ä–∏–ª–∞", color: "#f1c40f" },
      { label: "–ó–∞–¥–Ω–µ–ø—Ä–∏–≤–æ–¥–Ω—ã–π", color: "#e67e22" },
      { label: "–û—á–∫–æ–ª–∏–∑", color: "#2ecc71" },
      { label: "–¢—Ä–∞–Ω—Å–æ–ª—é–±", color: "#d35400" }
    ];

    // 2) –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ DOM-—ç–ª–µ–º–µ–Ω—Ç—ã
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spin-btn");
    const resultDiv = document.getElementById("result");

    // 3) –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–ª–µ—Å–∞
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = canvas.width / 2;
    const totalSegments = segments.length;
    const anglePerSegment = (2 * Math.PI) / totalSegments;

    // 4) –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    let currentRotation = 0; // —Ç–µ–∫—É—â–µ–µ —Å–º–µ—â–µ–Ω–∏–µ –∫–æ–ª–µ—Å–∞ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö
    let isSpinning = false;  // —Ñ–ª–∞–≥: –∏–¥—ë—Ç –ª–∏ –∞–Ω–∏–º–∞—Ü–∏—è —Å–µ–π—á–∞—Å

    // 5) –§—É–Ω–∫—Ü–∏—è, —Ä–∏—Å—É—é—â–∞—è –∫–æ–ª–µ—Å–æ –∏–∑ —Ü–≤–µ—Ç–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤
    function drawWheel() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < totalSegments; i++) {
        const startAngle = i * anglePerSegment;
        const endAngle = startAngle + anglePerSegment;

        // 5.1) –†–∏—Å—É–µ–º —Å–µ–∫—Ç–æ—Ä
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.closePath();
        ctx.fillStyle = segments[i].color;
        ctx.fill();
        ctx.strokeStyle = "#ffffff";
        ctx.lineWidth = 2;
        ctx.stroke();

        // 5.2) –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º —Å–µ–≥–º–µ–Ω—Ç (—Ç–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ–º –±–ª–∏–∂–µ –∫ –∫—Ä–∞—é)
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(startAngle + anglePerSegment / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#ffffff";
        ctx.font = "bold 18px Arial";
        ctx.fillText(segments[i].label, radius - 10, 10);
        ctx.restore();
      }
    }

    // –ü–µ—Ä–≤–∏—á–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–ª–µ—Å–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    drawWheel();

    // 6) –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ "–ö—Ä—É—Ç–∏—Ç—å"
    spinBtn.addEventListener("click", () => {
      if (isSpinning) return; // –µ—Å–ª–∏ —É–∂–µ –∫—Ä—É—Ç–∏—Ç—Å—è ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫
      isSpinning = true;
      spinBtn.disabled = true;
      resultDiv.textContent = "";

      // 6.1) –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤ (–æ—Ç 3 –¥–æ 5)
      const spins = Math.floor(Math.random() * 3) + 3;
      // 6.2) –í—ã–±–∏—Ä–∞–µ–º ‚Äú—Å–ª—É—á–∞–π–Ω—ã–π‚Äù —Å–µ–≥–º–µ–Ω—Ç (–∏–Ω–¥–µ–∫—Å 0..totalSegments-1)
      const randomIndex = Math.floor(Math.random() * totalSegments);
      // 6.3) –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª —Å—Ç–∞—Ä—Ç–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
      //      –ù–∞—á–∞–ª–æ —Å–µ–≥–º–µ–Ω—Ç–∞ = randomIndex * anglePerSegment
      const segmentStartAngle = randomIndex * anglePerSegment;
      // 6.4) –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π ‚Äú–≤–Ω—É—Ç—Ä–∏—Å–µ–≥–º–µ–Ω—Ç–Ω—ã–π‚Äù —Å–¥–≤–∏–≥,
      //      —á—Ç–æ–±—ã —Å—Ç—Ä–µ–ª–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∞—Å—å —Ç–æ—á–Ω–æ –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ, –∞ –≥–¥–µ-—Ç–æ –≤–Ω—É—Ç—Ä–∏:
      //      randomOffset ‚àà (0, anglePerSegment), –Ω–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ –≥—Ä–∞–Ω–∏—Ü–∞–º
      const epsilon = 0.0001; // –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–∑–æ—Ä, —á—Ç–æ–±—ã –Ω–µ –ø–æ–ø–∞—Å—Ç—å —Ç–æ—á–Ω–æ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü—É
      const randomOffset = Math.random() * (anglePerSegment - 2 * epsilon) + epsilon;
      //      –§–∏–Ω–∞–ª—å–Ω—ã–π —É–≥–æ–ª —Ü–µ–Ω—Ç—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (–≤ –Ω–µ—Ä–æ—Ç–æ—Ä–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏):
      const targetAngleInSegment = segmentStartAngle + randomOffset;

      // 6.5) –°—Ç—Ä–µ–ª–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤–ø—Ä–∞–≤–æ ‚Üí —ç—Ç–æ —É–≥–æ–ª 0 —Ä–∞–¥–∏–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ Canvas.
      //      –ß—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –æ–∫–∞–∑–∞–ª—Å—è —Å—Ç—Ä–æ–≥–æ —Å–ø—Ä–∞–≤–∞,
      //      –Ω—É–∂–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç—å –∫–æ–ª–µ—Å–æ –Ω–∞ targetAngleInSegment.
      //      –ü–ª—é—Å spins * 2œÄ, —á—Ç–æ–±—ã –±—ã–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤:
      const finalDelta = spins * 2 * Math.PI + (targetAngleInSegment - 0);

      // 6.6) –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ —Å–º–µ—â–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º CSS-–∞–Ω–∏–º–∞—Ü–∏—é
      currentRotation += finalDelta;
      canvas.style.transition = "transform 8s cubic-bezier(0.33, 1, 0.68, 1)";
      canvas.style.transform = `rotate(${currentRotation}rad)`;

      // 6.7) –ö–æ–≥–¥–∞ –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è ‚Äî –≤—ã—á–∏—Å–ª—è–µ–º, –∫–∞–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç ‚Äú–ø–æ–¥ —Å—Ç—Ä–µ–ª–∫–æ–π‚Äù
      canvas.addEventListener(
        "transitionend",
        () => {
          // 1) –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º currentRotation –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 2œÄ)
          let normalizedRotation = currentRotation % (2 * Math.PI);
          if (normalizedRotation < 0) {
            normalizedRotation += 2 * Math.PI;
          }

          // 2) –ü–æ—Å–∫–æ–ª—å–∫—É —Å—Ç—Ä–µ–ª–∫–∞ ‚Üí —Å–º–æ—Ç—Ä–∏—Ç –≤–ø—Ä–∞–≤–æ (—É–≥–æ–ª 0),
          //    –Ω–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–æ–º –∫–æ–ª–µ—Å–µ –ø–æ–¥ —Å—Ç—Ä–µ–ª–∫–æ–π —Å–µ–π—á–∞—Å –±—É–¥–µ—Ç —É–≥–æ–ª = ‚àínormalizedRotation.
          let rawAngle = -normalizedRotation;
          // 3) –ü—Ä–∏–≤–æ–¥–∏–º rawAngle –≤ [0, 2œÄ)
          rawAngle = ((rawAngle % (2 * Math.PI)) + 2 * Math.PI) % (2 * Math.PI);

          // 4) –ò–Ω–¥–µ–∫—Å –≤—ã–∏–≥—Ä–∞–≤—à–µ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ = —Ü–µ–ª–∞—è —á–∞—Å—Ç—å –æ—Ç –¥–µ–ª–µ–Ω–∏—è rawAngle/anglePerSegment
          //    –≠—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ—Ç —Å–µ–≥–º–µ–Ω—Ç, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å —Å—Ç—Ä–µ–ª–∫–∞.
          const winningIndex = Math.floor(rawAngle / anglePerSegment);
          const winningSegment = segments[winningIndex];

          resultDiv.textContent = `üéâ –°–µ–≥–æ–¥–Ω—è –ö–æ–ª—è: ${winningSegment.label}!`;

          // 5) –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥–∏, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∫—Ä—É—Ç–∏—Ç—å –µ—â—ë —Ä–∞–∑
          isSpinning = false;
          spinBtn.disabled = false;
        },
        { once: true }
      );
    });

    // 7) –ö–ª–∏–∫ –ø–æ —Å–∞–º–æ–º—É –∫–æ–ª–µ—Å—É —Ç–æ–∂–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Ä–∞—â–µ–Ω–∏–µ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
    canvas.addEventListener("click", () => {
      if (!isSpinning) {
        spinBtn.click();
      }
    });
  </script>
</body>
</html>
